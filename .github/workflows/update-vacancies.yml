name: Move to WWW Directory

on:
  workflow_dispatch: # –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

jobs:
  move-to-www:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        
      - name: Copy file to WWW directory
        run: |
          echo "=== –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –§–ê–ô–õ–ê –í WWW –î–ò–†–ï–ö–¢–û–†–ò–Æ ==="
          
          # –°–∫–∞—á–∏–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª
          echo "1. –°–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–∞..."
          curl -v \
            ftp://${{ secrets.FTP_SERVER }}/Vacancy/hh_vacancies.json \
            --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
            -o current_hh_vacancies.json || echo "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ /Vacancy/"
          
          # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª —Å–∫–∞—á–∞–ª—Å—è
          if [ -f "current_hh_vacancies.json" ]; then
            echo "‚úÖ –§–∞–π–ª —Å–∫–∞—á–∞–Ω —É—Å–ø–µ—à–Ω–æ"
            echo "–†–∞–∑–º–µ—Ä: $(stat -c%s current_hh_vacancies.json) –±–∞–π—Ç"
            
            # –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ WWW –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
            echo "2. –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ WWW –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é..."
            curl -v -T current_hh_vacancies.json \
              ftp://${{ secrets.FTP_SERVER }}/www/Vacancy/hh_vacancies.json \
              --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" \
              --ftp-create-dirs
            
            echo "‚úÖ –§–∞–π–ª —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ /www/Vacancy/"
          else
            echo "‚ùå –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"
          fi
          
      - name: Verify WWW placement
        run: |
          echo "=== –ü–†–û–í–ï–†–ö–ê –†–ê–ó–ú–ï–©–ï–ù–ò–Ø –í WWW ==="
          
          echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ /www/Vacancy/:"
          curl -v --list-only \
            ftp://${{ secrets.FTP_SERVER }}/www/Vacancy/ \
            --user "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" || echo "–ü–∞–ø–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
          
          echo ""
          echo "‚úÖ –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:"
          echo "üåê https://gradelift.ru/Vacancy/hh_vacancies.json"
